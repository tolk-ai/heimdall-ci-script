service: heimdall-node

provider:
  name: kubeless
  runtime: nodejs8
  namespace: kubeless
  environment:
    TRAINSET_VERSION: `${self:custom.${self:custom.stage}.TRAINSET_VERSION}`
    VALIDSET_VERSION: ${self:custom.${self:custom.stage}.VALIDSET_VERSION}
    INSPECTOR_GADGET_URL: ${self:custom.${self:custom.stage}.INSPECTOR_GADGET_URL}
    SENTRY_URL: ${self:custom.${self:custom.stage}.SENTRY_URL}
    DB: ${self:custom.${self:custom.stage}.DB}
    MONGO_USER: ${self:custom.${self:custom.stage}.MONGO_USER}
    MONGO_PASSWORD: ${self:custom.${self:custom.stage}.MONGO_PASSWORD}
    KAFKA_URL: ${self:custom.${self:custom.stage}.KAFKA_URL}

functions:
  freyr:
    handler: freyr/freyr.freyr
    events:
      - http: POST freyr

  frigg:
    handler: frigg/frigg.frigg
    events:
      - http: POST frigg

  heimdall:
    handler: heimdall/heimdall.heimdall
    events:
      - http: POST heimdall

  helheim:
    handler: helheim/helheim.helheim
    events:
      - http: POST helheim

  utgard:
    handler: utgard/utgard.utgard
    events:
      - http: POST utgard

custom:
  stage: "${opt:stage, self:provider.stage}"
  prod:
    TRAINSET_VERSION: '1.0.0'
    VALIDSET_VERSION: '1.0.0'
    DB: ''
    MONGO_USER: ${env:MONGO_USER, ''}
    MONGO_PASSWORD: ${env:MONGO_PASSWORD, ''}
  docker:
    TRAINSET_VERSION: '1.0.0'
    VALIDSET_VERSION: '1.0.0'
    INSPECTOR_GADGET_URL: ${env:INSPECTOR_GADGET_URL,'http://host.docker.internal:3010'}
    SENTRY_URL: ${env:SENTRY_URL,'http://host.docker.internal:3000/sentry'}
    DB: ${env:DB, 'mongodb://host.docker.internal:27017/heimdall-dev'}
    MONGO_USER: ${env:MONGO_USER, ''}
    MONGO_PASSWORD: ${env:MONGO_PASSWORD, ''}
    KAFKA_URL: ${env:KAFKA_URL,'http://host.docker.internal:9092'}
  dev:
    TRAINSET_VERSION: '1.0.0'
    VALIDSET_VERSION: '1.0.0'
    INSPECTOR_GADGET_URL: 'http://localhost:3010'
    SENTRY_URL: 'http://localhost:3000/sentry'
    DB: 'mongodb://localhost:27017/heimdall-dev'
    MONGO_USER: ''
    MONGO_PASSWORD: ''
    KAFKA_URL: 'http://locahost:9092'

plugins:
  - serverless-offline
